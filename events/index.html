<?php
  $text="Календарь мероприятий";
  require_once('../require/header.php');
?>
        <div class="col-md-9 col-lg-9">
          <p class="text-center block-header">КАЛЕНДАРЬ МЕРОПРИЯТИЙ</p>
            <div class="row">
                <div class="col-md-12">
                    <ul class="nav nav-tabs">
                        <?php
                            $sql="select * from category limit 1";
                            $result = mysqli_query($conn, $sql); 
                            while($row = mysqli_fetch_assoc($result)) 
                            {
                                $id=$row['ID'];
                                //echo '<li class="active">
                                   // <a data-toggle="tab" href="#tab'.$row['id'].'" role="tab">'.$row['sprvalue'].'</a></li>';
                                
                                    echo '<li role="presentation" class="active"><a data-toggle="tab" aria-controls="#tab'.$row['id'].'" data-target="#tab'.$row['id'].'" href="index.html?ajax=1&category='.$row['id'].'" 
                                    role="tab">'.$row['sprvalue'].'</a></li>';
                                
                                
                                $sql="select * from category limit 1, 100";
                                $result = mysqli_query($conn, $sql); 
                                while($row = mysqli_fetch_assoc($result)) 
                                {
                                    //echo '<li><a data-toggle="tab" href="#tab'.$row['id'].'" role="tab">'.$row['sprvalue'].'</a></li>';
                                    echo '<li role="presentation"><a data-toggle="tab" aria-controls="#tab'.$row['id'].'" data-target="#tab'.$row['id'].'" href="index.html?ajax=1&category='.$row['id'].'" 
                                    role="tab">'.$row['sprvalue'].'</a></li>';
                                } 
                            } 
                        ?>
                        <li><a data-toggle="tab" href="#arc" role="tab">Архив соревнований</a></li>
                    </ul>
                    <div class="tab-content">
                        <?php
                            $sql="select * from category";
                            $result = mysqli_query($conn, $sql); 
                            while($row = mysqli_fetch_assoc($result)) 
                            {
                                echo '<div id="tab'.$row['id'].'" class="tab-pane fade in" role="tabpanel" style="margin-top: 20px;"></div>';
                            } 
                        ?>
                        <div id="arc" class="tab-pane fade" role="tabpanel" style="margin-top: 20px;">
                            <div class="col-md-3">
                                <form class="form-horizontal" id="archive" method="POST" action="archive.html">
                                    <input type="hidden" name="command" value="go">
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-9">
                                                <input type="text" class="form-control" name="year" placeholder="Введите год">
                                            </div>
                                            <div class="col-md-3">
                                                <button class="btn btn-success" type="submit">Показать</button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                    </div>               
                </div>
            </div>
<?php
  if ($_GET['ajax']==1)
  {
?>
    <table class="table table-bordered table-striped">
        <thead>
            <th>Наименование соревнований</th>
            <th>Возраст участников</th>
            <th>Сроки проведения</th>
            <th>Место проведения</th>
            <th>Дисциплина</th>
        </thead>
        <tbody>
            <?php
            $sql="select name, age, DATE_FORMAT(eventDate, '%d.%m.%Y') as eventdate, 
            location, subject, filename from events where category=".$_GET['category']." order by eventdate desc";
            echo $sql;
            $result = mysqli_query($conn, $sql); 
            while($row = mysqli_fetch_assoc($result)) 
            {
                echo '<tr><td><a href="'.$row['filename'].'" target="_blank">'.$row['name'].'</a></td><td>'.$row['age'].'</td><td>'.$row['eventdate'].'</td><td>'.$row['location'].'</td>
                <td>'.$row['subject'].'</td></tr>';
            }

            ?>
        </tbody>
    </table>  
<?php
  }
  require_once('../require/footer.php');
?>
<script>
$('[data-toggle="tab"]').on('click', function(){
    var $this = $(this),
        source = $this.attr('href'),
        pane = $this.attr('data-target');
		
    if($(pane).is(':empty')) {  // check if pane is empty, if so get data
	  $.get(source, function(data) {
          $(pane).html(data);
      });
		
      $(this).tab('show');
      return false;
    }
});
</script>